# План: страница «Блог» с постами из VK

Цель: добавить страницу «Блог» в меню (после «Контакты»), контент которой по вашей команде подтягивается из сообщества VK [siberian_motorbears](https://vk.com/siberian_motorbears) и сохраняется на сайт в статическом виде (текст, картинки, ссылка на VK для комментов).

---

## 1. VK API: что использовать

### Методы API

| Метод | Назначение |
|-------|------------|
| **utils.resolveScreenName** | По короткому имени `siberian_motorbears` получить числовой `owner_id` группы (для стены он с минусом: `-XXXXX`). |
| **wall.get** | Получить записи со стены. Параметры: `owner_id`, `count` (до 100), `offset`, `filter=owner` (только посты от имени группы), `extended=0`. |

В ответе **wall.get** у каждой записи есть:

- `id`, `owner_id` — для ссылки на пост: `https://vk.com/siberian_motorbears?w=wall{owner_id}_{id}`
- `date` — Unix-время
- `text` — текст поста (уже с переносами строк)
- `attachments` — массив вложений. Для фото: `type: "photo"`, внутри объект с полями `photo_604`, `photo_807`, `photo_1280` и т.д. — URL картинок разных размеров. Можно брать, например, `photo_807` или максимальный доступный размер.

Для **публичной** стены чтение обычно возможно с **access_token** приложения (см. ниже). Сервисный ключ (Service key) у Standalone-приложения даёт доступ к части методов; для `wall.get` публичной группы часто достаточно пользовательского токена с правом `offline` (долгий срок жизни) или токена приложения — точнее смотреть в [документации VK API](https://dev.vk.com/method/wall.get) после окончания техработ.

---

## 2. Токен доступа (Access Token)

Варианты:

**Вариант A — приложение VK (у вас: Web, ID 54450309)**  
1. Один раз получить токен пользователя:  
   - В настройках приложения VK указать в «Базовый URL» или «Доверенный redirect URI» адрес: `https://api.vk.com/blank.html` (если ещё не указан).  
   - Открыть в браузере ссылку авторизации:  
     **https://oauth.vk.com/authorize?client_id=54450309&display=page&redirect_uri=https://api.vk.com/blank.html&scope=offline&response_type=token**  
   - Войти в VK, нажать «Разрешить». После редиректа в адресной строке будет что‑то вроде `https://api.vk.com/blank.html#access_token=...` — скопировать значение `access_token` (всё между `access_token=` и следующим `&`).  
2. Токен с `scope=offline` действует долго. Хранить в `scripts/.env` как `VK_ACCESS_TOKEN=...` (файл в .gitignore).

**Вариант B — Сервисный ключ**  
В настройках Standalone-приложения есть «Защищённый ключ». Для части методов (например, только чтение публичной стены) его могут разрешать — нужно проверить по актуальной документации VK.

Итог: скрипт будет читать токен из переменной окружения, например `VK_ACCESS_TOKEN`, или из файла `scripts/.env` (файл в `.gitignore`).

---

## 3. Скрипт «по команде» (общая схема)

Запуск: вы вручную выполняете один скрипт (например, раз в неделю или после новых постов в VK). Скрипт:

1. **Получает owner_id группы**  
   Запрос к `utils.resolveScreenName` с `screen_name=siberian_motorbears` → если `type=group`, то `object_id` — это ID группы, для стены передаём `owner_id = -object_id`.

2. **Запрашивает посты**  
   `wall.get(owner_id=-..., count=20, filter=owner)` (число и фильтр при необходимости настроить).

3. **Обрабатывает каждую запись**  
   - Текст: поле `text`, экранирование HTML, замена переносов на `<br>` или обёртка в `<p>`.  
   - Фото: из `attachments` брать объекты `type=="photo"`, из них URL (например `photo_807` или самый большой размер).  
   - Ссылка на пост: `https://vk.com/siberian_motorbears?w=wall{owner_id}_{id}`.

4. **Картинки — два варианта**  
   - **Простой:** в HTML подставлять прямые URL VK (сайт не хранит копии; зависимость от доступности VK).  
   - **Надёжный:** скачивать изображения в каталог сайта (например `site/assets/blog/` или `site/blog/img/`), в HTML подставлять локальные пути. Так контент остаётся у вас и не пропадёт при изменении политики VK.

5. **Генерация статики**  
   - Либо одна страница «Блог»: скрипт генерирует `site/blog/index.html` с перечислением постов (дата, отрывок текста, превью, ссылка «Читать в VK» / «Комментировать в VK»).  
   - Либо список + отдельная страница на пост: `site/blog/index.html` — список, `site/blog/2025-02-12-post-id.html` — полный текст, все фото, ссылка на VK.  
   Выбор зависит от желания: быстрее реализовать — одна страница; удобнее для SEO и шаринга — отдельные страницы по постам.

6. **Формат данных (опционально)**  
   Можно сохранять сырой ответ VK в JSON (например `site/blog/posts.json`) и отдельным шагом или тем же скриптом генерировать HTML. Так проще отлаживать и менять шаблон без повторных запросов к API.

Язык скрипта: **Python** (как у вас в `scripts/`) — запросы через `requests`, парсинг JSON, генерация HTML шаблонизатором или просто подстановкой в шаблон.

---

## 4. Изменения на сайте

- **Меню**  
  Во всех страницах в блоке `main-nav` после пункта «Контакты» добавить пункт «Блог» с ссылкой на `blog/index.html` (или `../blog/index.html` с вложенных страниц).  
  Файлы для правки: `site/index.html`, `site/contact/index.html`, `site/rent/index.html`, `site/order/index.html`, `site/baribal/index.html`, `site/baron/index.html`, `site/panda/index.html`, `site/mia/index.html`, `site/examples/index.html`, `site/legal/index.html`.

- **Страница блога**  
  - Создать каталог `site/blog/`.  
  - Либо скрипт каждый раз перезаписывает `site/blog/index.html` (и при необходимости `site/blog/<slug>.html`), либо вы один раз делаете шаблон, а скрипт только подставляет контент.  
  - В шаблоне: тот же header/footer и стили, что на остальных страницах (`../css/main.css` и т.д.), блок с постами, под каждым постом — кнопка/ссылка «Комментировать в VK» с ссылкой на `https://vk.com/siberian_motorbears?w=wall{owner_id}_{id}`.

- **SEO (по желанию)**  
  - В `sitemap.xml` добавить `https://siberian-motorbears.ru/blog/` и при наличии отдельных страниц постов — их URL.  
  - В `blog/index.html`: заголовок, meta description, Open Graph по аналогии с другими страницами сайта.

---

## 5. Порядок действий (чек-лист)

| # | Шаг |
|---|-----|
| 1 | Создать Standalone-приложение VK, получить access token (один раз), сохранить в `VK_ACCESS_TOKEN` или в `scripts/.env`. |
| 2 | Написать скрипт (например `scripts/vk_blog_sync.py`): resolveScreenName → wall.get → разбор постов и вложений (текст + фото). |
| 3 | Решить: картинки — только URL VK или скачивание в `site/blog/img/` (или `site/assets/blog/`). Реализовать выбранный вариант в скрипте. |
| 4 | Сделать HTML-шаблон блога (одна страница со списком или список + страницы постов), генерацию этого HTML в скрипте. |
| 5 | Добавить пункт «Блог» в меню на всех страницах после «Контакты». |
| 6 | Запустить скрипт, проверить `site/blog/index.html` в браузере. |
| 7 | При необходимости обновить `sitemap.xml` и мета-теги блога. |

Дальше можно добавить в README или в комментарий к скрипту команду вида:  
`VK_ACCESS_TOKEN=... python scripts/vk_blog_sync.py`  
— «по команде» вы просто запускаете это когда нужно обновить блог.

---

## 6. Полезные ссылки

- [wall.get](https://dev.vk.com/method/wall.get) — описание метода (на время техработ может быть недоступно).  
- [utils.resolveScreenName](https://dev.vk.com/method/utils.resolveScreenName) — короткое имя → id.  
- [Формат вложений (attachments)](https://dev.vk.com/reference/objects/post) — описание полей поста, в т.ч. фото.  
- Токен: [получение через OAuth](https://vk.com/dev/access_token) / Standalone.

Если нужно, следующий шаг — набросок скрипта `vk_blog_sync.py` (без токена, с заглушками под ваш выбор: одна страница или отдельные страницы постов, и куда класть картинки).

---

**Текущая реализация** (скрипты, обновление из VK, индивидуальные страницы, заголовки) описана в **[docs/BLOG.md](BLOG.md)**.
