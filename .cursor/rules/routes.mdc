---
description: Как прорабатывать и добавлять новые маршруты на /routes/
globs: site/routes/**/*
alwaysApply: false
---

# Маршруты: добавление и правки

Полная инструкция: **site/routes/README-ROUTES.md**. Ниже — контекст для AI.

## Файлы и роли

| Файл | Роль |
|------|------|
| **build-route-geometries.js** | Треки для OSRM: ключ → массив точек `[lat, lng]` в порядке проезда. Точки — конкретные объекты (ГЛК, достопримечательности), не «область вообще». |
| **route-geometries.js** | **Только генерируется скриптом.** Вручную не править. |
| **routes-maps.js** | ROUTES[key]: center, zoom, track (те же точки), waypoints (маркеры с title, type: sight/stop). |
| **index.html** | Карточки маршрутов, легенда, ROUTE_INFO, ROUTE_ORDER, PALETTE. |

Один и тот же **key** (латинница, подчёркивание) используется везде: `data-route`, ROUTES, TRACKS, ROUTE_GEOMETRIES, ROUTE_INFO, ROUTE_ORDER. **sectionId** — `route-N-name`, совпадает с `id` карточки и `href` в легенде.

## Порядок при добавлении маршрута

1. **build-route-geometries.js** — добавить key в TRACKS с массивом точек.
2. Запустить генерацию геометрии: `cd site/routes && node build-route-geometries.js <key>` (для одного маршрута; без аргумента — все).
3. **routes-maps.js** — добавить ROUTES[key] (center, zoom, track, waypoints).
4. **index.html** — пункт в легенде, ROUTE_INFO[key], key в ROUTE_ORDER, при необходимости цвет в PALETTE, карточка `<article id="route-N-...">` с блоком карты `data-route="key"`.

В карточке в **route-meta** обязательно указать примерное расстояние («~XXX км кольцом» или «туда-обратно») и при необходимости «N дней в дороге».

## Сортировка и исключение ski_ring

- Маршруты на странице и в легенде упорядочены по **продолжительности** (короткие → длинные).
- **Горнолыжный маршрут** `ski_ring` («Горнолыжное кольцо Сибири») **всегда последний** и **не участвует** в сортировке по длительности. Новые маршруты вставлять **перед** `ski_ring` в списке карточек и в ROUTE_ORDER.

## Проверка

Легенда → скролл к карточке и подсветка на общей карте; тултип по наведению на линию; карта в карточке строится по ROUTES[key] и ROUTE_GEOMETRIES[key]; «К списку маршрутов» ведёт к общей карте.
